version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "Use Node from .nvmrc (fallback 20)"
        - NODEVER=$(cat .nvmrc 2>/dev/null || echo "20")
        - nvm install $NODEVER
        - nvm use $NODEVER
        - node -v
        # clean Windows lock + modules to avoid optional-deps bug
        - rm -rf node_modules package-lock.json
        - npm install
    build:
      commands:
        - npm run build
  artifacts:
    baseDirectory: dist
    files:
      - '**/*'
  cache:
    # keep cache minimal to avoid stale node_modules
    paths: []
